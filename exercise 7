USE MASTER
GO

IF EXISTS (SELECT * FROM sys.databases WHERE NAME = 'adventuresReservations')
DROP DATABASE adventuresReservations

CREATE DATABASE adventuresReservations
GO

--CREATING CUSTOMER TABLE--
CREATE TABLE Customer 
(Customer_Num CHAR (7) PRIMARY KEY NOT NULL,
FirstName CHAR (10) NOT NULL,
LastName CHAR (15) NOT NULL,				--	NOT NULL = MUST NOT LEAVE A BLANK SPACE = REQUIRED 
Address VARCHAR (30) NOT NULL,				--	NOT NULL = REQUIRED
CITY VARCHAR (50) NOT NULL,					--	NULL = EMPTY 
Postal_Code VARCHAR (7) NOT NULL,
Phone_Number VARCHAR (10) 
)

--CREATING TRIP TABLE--
CREATE TABLE Trip
(Trip_ID INT IDENTITY (1,10) PRIMARY KEY NOT NULL,
Trip_Name VARCHAR (25) NOT NULL,
Location VARCHAR (25) NOT NULL
)

--CREATE RESERVATION TABLE--
CREATE TABLE Reservation 
(Reservation_ID VARCHAR (10) PRIMARY KEY,					-- USE REFERENCES TO REFERENCE FK RELATIONSHIPS BETWEEN TABLES 
Customer_Num CHAR (7) REFERENCES Customer(Customer_Num),
Trip_ID INT IDENTITY (1,10) REFERENCES Trip(Trip_ID),		-- WHEN USING DECIMAL 7 MEANS WE CAN ONLY HAVE 7 NUMBERS BEFORE COMMA
Trip_Price DECIMAL (7,2) NOT NULL,							-- 2 MEANS WE CAN ONLY HAVE 2 NUMBERS AFTER COMMA
Trip_date DATETIME 
)

--CREATING GUIDE TABLE --
CREATE TABLE Guide 
(Guide_Num VARCHAR (10) PRIMARY KEY NOT NULL,
FirstName CHAR (10) NOT NULL
)

--CREATING TRIP_GUIDE TABLE--
CREATE TABLE Trip_Guide
(Trip_ID INT IDENTITY (1,10) REFERENCES Trip(Trip_ID),		-- BRIDGING TABLE, THEY ARE (FK,PK) TYPE OF A RELATIONSHIP
Guide_Num VARCHAR (10) REFERENCES Guide(Guide_Num),			-- THE TABLES DOESNT HAVE ITS OWN PK
PRIMARY KEY (Trip_ID,Guide_Num)
)

--INSERTING VALUES IN TABLES--

INSERT INTO Guide VALUES 
('RH01','Miles'),
('AM01','Boyers');

INSERT INTO Trip VALUES 
('MT ASCUTNEY - NORTH PEAK','WEATHERSFIELD'),
('SEAL BACH HARBOR','BAR HARBOR');

INSERT INTO Trip_Guide VALUES 
('RH01')

INSERT INTO Customer VALUES 
(1,'Chester','Lekhuleni','8769st','PTA','0028','0194347817')

INSERT INTO Reservation VALUES
(1,1,'10000','2020-10-04')

--joining the tables--

SELECT * 
FROM CUSTOMER c
INNER JOIN Reservation r
ON c.Customer_Num = r.Customer_Num
INNER JOIN Trip t
ON r.Trip_ID = t.Trip_ID
INNER JOIN Trip_Guide tg
ON t.Trip_ID = tg.Trip_ID
INNER JOIN Guide g
ON tg.Guide_Num = g.Guide_Num
GO

--STORED PROCEDURE--

CREATE PROCEDURE customerRes
@Customer_Num CHAR (7),
@FirstName CHAR (10),
@LastName CHAR (15) ,
@Address VARCHAR (30),												--parameters--
@CITY VARCHAR (50),
@Postal_Code VARCHAR (7),
@Phone_Number VARCHAR (10) 
AS								
BEGIN TRY
	BEGIN TRANSACTION
		INSERT INTO Customer VALUES (@Customer_Num,@FirstName,@LastName,@Address,@CITY,@Postal_Code,@Phone_Number) 
	COMMIT 
	PRINT 'Customer added'
END TRY

BEGIN CATCH
	ROLLBACK TRANSACTION
	PRINT 'THE TRANSACTION WAS NOT COMPLETED'
END CATCH

--EXECUTING PROCEDURE--

EXECUTE customerRes 3,Nondumiso,shabalala,uehf89,djfd,9879,0932376783


SELECT * FROM Customer
